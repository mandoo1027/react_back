<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BBS">

	<!-- 게시판 조회 -->
	<select id="selectPostIdNextVal" resultType="hashmap">
		SELECT nextval('posts_id_seq') posts_id_seq
	</select>

	<!-- 메뉴 조회 -->
	<select id="selectBBS" parameterType="hashmap" resultType="hashmap">
		SELECT
		p.id as postId,
		p.title,
		p.contents,
		get_user_name(p.rgtr_user_id) AS rgtr_user_name,
		p.rgtr_dt,
		p.last_user_id,
		get_user_name(p.last_user_id) AS last_user_name,
		p.last_chg_at,
		p.isNotice
		FROM posts p
		<where>
			<if test="searchKeyword != null and searchKeyword != ''">
				AND (p.title LIKE CONCAT('%', #{searchKeyword}, '%')
				OR p.contents LIKE CONCAT('%', #{searchKeyword}, '%'))
			</if>
			<if test="rgtrUserName != null and rgtrUserName != ''">
				AND get_user_name(p.rgtr_user_id) LIKE CONCAT('%', #{rgtrUserName}, '%')
			</if>
			<if test="isNotice != null">
				AND p.isNotice = #{isNotice}
			</if>
			<if test="postid != null and postid != ''">
				AND p.id = #{postid}
			</if>
		</where>
		ORDER BY p.rgtr_dt DESC
	</select>

	<!-- 메뉴 등록 -->
	<insert id="insertBBS" parameterType="hashmap">
		<![CDATA[
		    INSERT INTO posts (id,title, contents, rgtr_user_id, rgtr_dt, last_user_id, last_chg_at, isNotice)
			VALUES
			(#{postId},#{title}, #{contents, jdbcType=BINARY}, #{rgtrUserId}, TO_CHAR(NOW(), 'YYYYMMDDHH24MISS'), #{lastUserId}, TO_CHAR(NOW(), 'YYYYMMDDHH24MISS'), #{isNotice})
	]]>
	</insert>
	<delete id="deleteMenu" parameterType="hashmap">
		DELETE FROM MENU
		WHERE 1=1
		AND   SYS_DIV_CD = #{sysDivCd}
		AND   MENU_CODE = #{menuCode}
	</delete>
	<update id="updateMenu" parameterType="hashmap">
		<![CDATA[
		UPDATE MENU
		SET
			  MENU_NAME = #{menuName}		-- 메뉴_화면명
			, MENU_DEPTH = CAST(#{menuDepth} AS INTEGER)			-- 메뉴단계
			, MENU_SEQ =  CAST(#{menuSeq} AS INTEGER)			-- 메뉴노출순서 : 메뉴 depth 내 순서
			, UPPER_MENU_CODE = #{upperMenuCode}	-- 상위메뉴코드
			, FILE_PATH = #{filePath}		-- 화면경로 : /COM/COM002M00
			, LOGIN_YN = #{loginYn}			-- 로그인여부
			, SCR_CTN = #{scrCtn}			-- 화면설명
			, MENU_CSS = #{menuCss}			-- 메뉴CSS
			, USE_END_DATE = #{useEndDate}	-- 사용종료일자
			, USE_STRT_DATE = #{useStrtDate}	-- 사용시작일자
			, USE_YN = #{useYn}				-- 사용여부
			, LAST_USER_ID = #{lastUserId}	-- 수정자
			, LAST_CHG_DT = TO_CHAR(NOW(), 'YYYYMMDDHH24MISS')		-- 수정일자
		WHERE 1=1
		AND   SYS_DIV_CD = #{sysDivCd}
		AND   MENU_CODE = #{menuCode}
	]]>
	</update>
</mapper>